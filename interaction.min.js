/*
	Library Activity Logger(LAL), Version 1.1
	Â© 2017, Brian Jameson, Blacksburg High School
	Licensed under GPL Version 3 licenses.
	Requires the ExcelPlus JavaScript Library
	http://aymkdn.github.io/ExcelPlus/
*/
function addToXLSX(){if(7!=epx.getSheetNames().length)return void alert("Invalid file uploaded!");endAll();for(var a=0,b=dataStorage[a].slice(0);a<dataStorage.length;a++)b.shift(),b=addDate(sheets),epx.selectSheet(sheetNames[a]),writeData(epx,b);epx.saveAs("data.xlsx")}function writeData(a,b){for(i=0;i<b.length;i++)a.writeNextRow(b[i])}function monthWord(){return["January","February","March","April","May","June","July","August","September","October","November","December"][(new Date).getMonth()]}function loggedInOnly(a){switch(a){case"v":constructDisplay(dataStorage[1],"vdisplay"),document.getElementById("liov").innerHTML=lIOV?"View Logged In Only":"View All",lIOV=!lIOV;break;case"h":constructDisplay(dataStorage[0],"hdisplay"),document.getElementById("lioh").innerHTML=lIOH?"View Logged In Only":"View All",lIOH=!lIOH;break;case"c":constructDisplay(dataStorage[2],"cdisplay"),document.getElementById("lioc").innerHTML=lIOC?"View Logged In Only":"View All",lIOC=!lIOC;break;default:alert("Error in loggedInOnly()!")}}function lIODisplay(a){for(var b=0;b<a.length;b++)a[b][2].length<=5&&(a.splice(b,1),b--);return a}function addDate(a){for(var b=0,c=new Date;b<a.length;b++)a[b].push(c.toLocaleDateString());return a}function exportXLSX(a){var b=new ExcelPlus;a&&endAll(),b.createFile(sheetNames);for(var c=0;c<dataStorage.length;c++)b.write({sheet:sheetNames[c],content:dataStorage[c]});var d=new Date;b.saveAs(d.toLocaleString().replace("/","-")+".xlsx")}function tabSelect(a,b){var d,c=document.getElementsByClassName("tabcontent"),e=document.getElementsByClassName("tablinks");for(d=0;d<c.length;d++)c[d].style.display="none";for(d=0;d<e.length;d++)e[d].className=e[d].className.replace(" active","");document.getElementById(b).style.display="block",a.currentTarget.className+=" active"}function endEntry(a,b,c){b[a][2]=getTime("string12"),constructDisplay(b,c)}function removeEntry(a,b){switch(b){case"vdisplay":dataStorage[1].splice(a,1),constructDisplay(dataStorage[1],b);break;case"cdisplay":dataStorage[2].splice(a,1),constructDisplay(dataStorage[2],b);break;case"hdisplay":dataStorage[0].splice(a,1),constructDisplay(dataStorage[0],b)}}function endAll(){endVisitors(),endCVisits(),endHallPass()}function endVisitors(){for(var a=0;a<dataStorage[1].length;a++)dataStorage[1][a][2].length>10&&endEntry(a,dataStorage[1],"vdisplay")}function endCVisits(){for(var a=0;a<dataStorage[2].length;a++)dataStorage[2][a][2].length>10&&endEntry(a,dataStorage[2],"cdisplay")}function endHallPass(){for(var a=0;a<dataStorage[0].length;a++)dataStorage[0][a][2].length>10&&endEntry(a,dataStorage[0],"hdisplay")}function constructDisplay(a,b){var c=a.slice(0),d=document.getElementById(b),e="";switch(b){case"vdisplay":lIOV&&(c=lIODisplay(c));break;case"cdisplay":lIOC&&(c=lIODisplay(c));break;case"hdisplay":lIOH&&(c=lIODisplay(c));break;default:alert("Error in constructDisplay!")}c.reverse(),c.unshift(c.pop());for(var g,f=0;f<c.length;f++){for(e+="<tr>",g=0;g<c[0].length;g++)e+=0==f?"<th>":"<td>",e+=c[f][g],e+=0==f?"</th>":"</td>",g++;null!=document.getElementById("sselector")&&f>0&&(e+='<td><button type="button" onclick="removeEntry('+(c.length-f)+", '"+b+"')\">X</button></td>"),e+="</tr>"}d.innerHTML=e}function submitData(a){var c,b=getTime("string12");if(0==document.getElementById(a+"fname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById(a+"lname").value.length)return void alert("You need to input a last name!");switch(a){case"a":switch(c=document.getElementById("afname").value+" "+document.getElementById("alname").value,document.getElementById("afname").value="",document.getElementById("alname").value="",whichClass()){case 0:dataStorage[3][dataStorage[3].length]=new Array(c,b,!1);break;case 1:dataStorage[3][dataStorage[3].length]=new Array(c,b,!0);break;case 2:dataStorage[4][dataStorage[4].length]=new Array(c,b,!1);break;case 3:dataStorage[4][dataStorage[4].length]=new Array(c,b,!0);break;case 4:dataStorage[5][dataStorage[5].length]=new Array(c,b,!1);break;case 5:dataStorage[5][dataStorage[5].length]=new Array(c,b,!0);break;case 6:dataStorage[6][dataStorage[6].length]=new Array(c,b,!1);break;case 7:dataStorage[6][dataStorage[6].length]=new Array(c,b,!0);break;case 8:return void alert("The school day has ended!");default:return void alert("Error in submitData()!")}alert(c+" is now signed in!");break;case"h":var d=document.getElementById("hdestination"),e=d.value;if(null!=document.getElementById("hteacher")){var f=document.getElementById("hteacher").value;if(0==f.length)return void alert("You need to input the teacher you're going to!");e+=": "+f}if(null!=document.getElementById("hcounselor")){var g=document.getElementById("hcounselor").value;if(0==g.length)return void alert("You need to input the counselor you're going to!");e+=": "+g}c=document.getElementById("hfname").value+" "+document.getElementById("hlname").value,document.getElementById("hfname").value="",document.getElementById("hlname").value="",dataStorage[0][dataStorage[0].length]=new Array(c,b,'<button type="button" onclick="endEntry('+dataStorage[0].length+", dataStorage[0], 'hdisplay')\">In</button>",e),d.value="Bathroom",hallPassTeachers(),constructDisplay(dataStorage[0],"hdisplay");break;case"v":c=document.getElementById("vfname").value+" "+document.getElementById("vlname").value,document.getElementById("vfname").value="",document.getElementById("vlname").value="",dataStorage[1][dataStorage[1].length]=new Array(c,b,'<button type="button" onclick="endEntry('+dataStorage[1].length+", dataStorage[1], 'vdisplay')\">Out</button>",document.getElementById("vreason").value,document.getElementById("vteacher").value),document.getElementById("vreason").value="Work independently on a class assignment",document.getElementById("vteacher").value="C. Baker",constructDisplay(dataStorage[1],"vdisplay");break;case"c":if(0==document.getElementById("creason").value.length)return void alert("You need to input a reason!");if(0==document.getElementById("classsize").value.length)return void alert("You need to input the number of students!");c=document.getElementById("cfname").value+" "+document.getElementById("clname").value,document.getElementById("cfname").value="",document.getElementById("clname").value="",dataStorage[2][dataStorage[2].length]=new Array(c,b,'<button type="button" onclick="endEntry('+dataStorage[2].length+", dataStorage[2], 'cdisplay')\">Out</button>",document.getElementById("creason").value,document.getElementById("classsize").value),constructDisplay(dataStorage[2],"cdisplay"),document.getElementById("creason").value="",document.getElementById("classsize").value="";break;default:alert("Error in submitData()!")}}function getTime(a){var b=new Date,c=b.getHours(),d=b.getMinutes();switch(a){case"array":return[c,d];case"string12":return c>12&&(c-=12),c+(d<10?":0":":")+d;case"string24":return c+(d<10?":0":":")+d;case"minct":return 60*c+d;default:alert("Invalid getTime() argument!")}}function passWord(a){passWordCheck(document.getElementById(a).value)?(document.getElementById("l").innerHTML='<p>\t\t\t\t<button type="button" onclick="exportXLSX(true)">Export Data</button>\t\t\t</p>\t\t\t<p>\t\t\t\t<object id="file-object"></object>\t\t\t\t<button type="button" onclick="addToXLSX()">Add Data to Selected File</button>\t\t\t\t<a href="https://chrome.google.com/webstore/detail/downloads-overwrite-exist/fkomnceojfhfkgjgcijfahmgeljomcfk">This Chrome extension is required to update an existing spreadsheet.</a>\t\t\t</p>\t\t\t<p>\t\t\t\tSchedule for Day:\t\t\t\t<select id="sselector" onchange="schedule = document.getElementById("sselector").value;">\t\t\t\t\t<option value="normal">Standard day</option>\t\t\t\t\t<option value="earlyReleaseOrClubDay">Early Release/Club Day</option>\t\t\t\t\t<option value="oneHourDelay">1 Hour Delay</option>\t\t\t\t\t<option value="twoHourDelay">2 Hour Delay</option>\t\t\t\t</select>\t\t\t</p>\t\t\t<button type="button" onclick="endVisitors(); endCVisits()">Sign Out All Visitors</button>\t\t\t<button type="button" onclick="closeMenu()">Lock Librarian Menu</button>',document.getElementById("sselector").value=schedule,epx.openLocal({labelButton:"Select Excel File"},function(){}),constructDisplay(dataStorage[0],"hdisplay"),constructDisplay(dataStorage[1],"vdisplay"),constructDisplay(dataStorage[2],"cdisplay")):alert("Incorrect password!")}function closeMenu(){document.getElementById("l").innerHTML='<span><input type="password" id="pwbox" placeholder="Password"></span>\t\t<span><button onclick="passWord(\'pwbox\')">Submit</button></span>',constructDisplay(dataStorage[0],"hdisplay"),constructDisplay(dataStorage[1],"vdisplay"),constructDisplay(dataStorage[2],"cdisplay")}function hallPassTeachers(){var a=document.getElementById("hdestination").value,b=document.getElementById("moreinputs");switch(a){case"Teacher":b.innerHTML='<input type="text" id="hteacher" placeholder="Teacher">';break;case"Guidance":b.innerHTML='<input type="text" id="hcounselor" placeholder="Guidance Counselor">';break;default:b.innerHTML=""}}function passWordCheck(a){var b=[66,72,83,76,105,98,114,97,114,121];if(b.length!=a.length)return!1;for(var c=0;c<b.length;c++)if(b[c]!=a.charCodeAt(c))return!1;return!0}function whichClass(){var b,a=beginTimes(),c=getTime("minct");for(b=0;b<a.length&&c>=a[b];b++);return b}function beginTimes(){switch(schedule){case"earlyReleaseOrClubDay":return[486,540,546,595,601,685,691,740];case"oneHourDelay":return[546,620,626,700,706,810,816,890];case"twoHourDelay":return[606,665,671,730,736,825,831,890];default:return[486,575,581,670,676,795,801,890]}}var dataStorage=[[["Name","Time Out","Time In","Destination"]],[["Name","Time In","Time Out","Reason","Teacher"]],[["Name","Time In","Time Out","Reason","Student Count"]],[["Name","Time","Tardy?"]],[["Name","Time","Tardy?"]],[["Name","Time","Tardy?"]],[["Name","Time","Tardy?"]]],sheetNames=["Hall Pass","Visitors","Class Visitors","Class 1","Class 2","Class 3","Class 4"],schedule="normal",epx=new ExcelPlus,lIOV=!1,lIOC=!1,lIOH=!1;setInterval(function(){exportXLSX(!1)},36e5);