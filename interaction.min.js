/*
	Library Activity Logger(LAL), Version 1.1
	Copyright 2016, Brian Jameson, Blacksburg High School Class of 2017
	Licensed under GPL Version 3 licenses.
	Requires the ExcelPlus JavaScript Library
	http://aymkdn.github.io/ExcelPlus/
*/
function addToXLSX(){if(7!=epx.getSheetNames().length)return void alert("Invalid file uploaded!");endAll();for(var a=[hallPass.slice(0),visitors.slice(0),cVisits.slice(0),firstClass.slice(0),secondClass.slice(0),thirdClass.slice(0),fourthClass.slice(0)],b=0;b<7;b++)a[b].shift(),a[b]=addDate(a[b]),epx.selectSheet(sheetNames[b]),writeData(epx,a[b]);epx.saveAs("data.xlsx")}function writeData(a,b){for(i=0;i<b.length;i++)a.writeNextRow(b[i])}function monthWord(){return["January","February","March","April","May","June","July","August","September","October","November","December"][(new Date).getMonth()]}function loggedInOnly(a){switch(a){case"v":constructDisplay(visitors.slice(0),"vdisplay"),document.getElementById("liov").innerHTML=lIOV?"View Logged In Only":"View All",lIOV=!lIOV;break;case"h":constructDisplay(hallPass.slice(0),"hdisplay"),document.getElementById("lioh").innerHTML=lIOH?"View Logged In Only":"View All",lIOH=!lIOH;break;case"c":constructDisplay(cVisits.slice(0),"cdisplay"),document.getElementById("lioc").innerHTML=lIOC?"View Logged In Only":"View All",lIOC=!lIOC;break;default:alert("Error in loggedInOnly()!")}}function lIODisplay(a){for(i=0;i<a.length;i++)a[i][2].length<=5&&(a.splice(i,1),i--);return a}function addDate(a){var b=new Date;for(i=a.length-1;i>=0;i--)a[i].push(b.toLocaleDateString());return a}function exportXLSX(a){var b=new ExcelPlus,c=[hallPass,visitors,cVisits,firstClass,secondClass,thirdClass,fourthClass];a&&endAll(),b.createFile(sheetNames);for(var d=0;d<7;d++)b.write({sheet:sheetNames[d],content:c[d]});var e=new Date;b.saveAs(e.toLocaleString().replace("/","-")+".xlsx")}function tabSelect(a,b){var d,c=document.getElementsByClassName("tabcontent"),e=document.getElementsByClassName("tablinks");for(d=0;d<c.length;d++)c[d].style.display="none";for(d=0;d<e.length;d++)e[d].className=e[d].className.replace(" active","");document.getElementById(b).style.display="block",a.currentTarget.className+=" active"}function endEntry(a,b,c){b[a][2]=getTime("string12"),constructDisplay(b.slice(0),c)}function removeEntry(a,b){switch(b){case"vdisplay":visitors.splice(a,1),constructDisplay(visitors.slice(0),b);break;case"cdisplay":cVisits.splice(a,1),constructDisplay(cVisits.slice(0),b);break;case"hdisplay":tgtArray=hallPass,hallPass.splice(a,1),constructDisplay(hallPass.slice(0),b)}}function endAll(){endVisitors(),endCVisits(),endHallPass()}function endVisitors(){for(var a=visitors.length-1;a>0;a--)visitors[a][2].length>10&&endEntry(a,visitors,"vdisplay")}function endCVisits(){for(var a=cVisits.length-1;a>0;a--)cVisits[a][2].length>10&&endEntry(a,cVisits,"cdisplay")}function endHallPass(){for(var a=hallPass.length-1;a>0;a--)hallPass[a][2].length>10&&endEntry(a,hallPass,"hdisplay")}function constructDisplay(a,b){var f,g,c=a,d=document.getElementById(b),e="";switch(b){case"vdisplay":lIOV&&(c=lIODisplay(c));break;case"cdisplay":lIOC&&(c=lIODisplay(c));break;case"hdisplay":lIOH&&(c=lIODisplay(c));break;default:alert("Error in constructDisplay!")}for(c.reverse(),c.unshift(c.pop()),f=0;f<c.length;f++){for(e+="<tr>",g=0;g<c[0].length;g++)e+=0==f?"<th>":"<td>",e+=c[f][g],e+=0==f?"</th>":"</td>",g++;null!=document.getElementById("sselector")&&f>0&&(e+='<td><button type="button" onclick="removeEntry('+(c.length-f)+", '"+b+"')\">X</button></td>"),e+="</tr>"}d.innerHTML=e}function submitData(a){var c,b=getTime("string12");switch(a){case"a":if(0==document.getElementById("afname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("alname").value.length)return void alert("You need to input a last name!");switch(c=document.getElementById("afname").value+" "+document.getElementById("alname").value,document.getElementById("afname").value="",document.getElementById("alname").value="",whichClass()){case 0:firstClass[firstClass.length]=new Array(c,b,!1);break;case 1:firstClass[firstClass.length]=new Array(c,b,!0);break;case 2:secondClass[secondClass.length]=new Array(c,b,!1);break;case 3:secondClass[secondClass.length]=new Array(c,b,!0);break;case 4:thirdClass[thirdClass.length]=new Array(c,b,!1);break;case 5:thirdClass[thirdClass.length]=new Array(c,b,!0);break;case 6:fourthClass[fourthClass.length]=new Array(c,b,!1);break;case 7:fourthClass[fourthClass.length]=new Array(c,b,!0);break;case 8:return void alert("The school day has ended!");default:return void alert("Error in submitData()!")}alert(c+" is now signed in!");break;case"h":var d=document.getElementById("hdestination"),e=d.value;if(0==document.getElementById("hfname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("hlname").value.length)return void alert("You need to input a last name!");if(null!=document.getElementById("hteacher")){var f=document.getElementById("hteacher").value;if(0==f.length)return void alert("You need to input the teacher you're going to!");e=d.value+": "+f}if(null!=document.getElementById("hcounselor")){var g=document.getElementById("hcounselor").value;if(0==g.length)return void alert("You need to input the counselor you're going to!");e=d.value+": "+g}c=document.getElementById("hfname").value+" "+document.getElementById("hlname").value,document.getElementById("hfname").value="",document.getElementById("hlname").value="",hallPass[hallPass.length]=new Array(c,b,'<button type="button" onclick="endEntry('+hallPass.length+", hallPass, 'hdisplay')\">In</button>",e),d.value="Bathroom",hallPassTeachers(),constructDisplay(hallPass.slice(0),"hdisplay");break;case"v":if(0==document.getElementById("vfname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("vlname").value.length)return void alert("You need to input a last name!");c=document.getElementById("vfname").value+" "+document.getElementById("vlname").value,document.getElementById("vfname").value="",document.getElementById("vlname").value="",visitors[visitors.length]=new Array(c,b,'<button type="button" onclick="endEntry('+visitors.length+", visitors, 'vdisplay')\">Out</button>",document.getElementById("vreason").value,document.getElementById("vteacher").value),document.getElementById("vreason").value="Work independently on a class assignment",document.getElementById("vteacher").value="C. Baker",constructDisplay(visitors.slice(0),"vdisplay");break;case"c":if(0==document.getElementById("cfname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("clname").value.length)return void alert("You need to input a last name!");if(0==document.getElementById("creason").value.length)return void alert("You need to input a reason!");if(0==document.getElementById("classsize").value.length)return void alert("You need to input the number of students!");c=document.getElementById("cfname").value+" "+document.getElementById("clname").value,document.getElementById("cfname").value="",document.getElementById("clname").value="",cVisits[cVisits.length]=new Array(c,b,'<button type="button" onclick="endEntry('+cVisits.length+", cVisits, 'cdisplay')\">Out</button>",document.getElementById("creason").value,document.getElementById("classsize").value),constructDisplay(cVisits.slice(0),"cdisplay"),document.getElementById("creason").value="",document.getElementById("classsize").value="";break;default:alert("Error in submitData()!")}}function getTime(a){var b=new Date,c=b.getHours(),d=b.getMinutes();switch(a){case"array":return[c,d];case"string12":return c>12&&(c-=12),d<10?c+":0"+d:c+":"+d;case"string24":return d<10?c+":0"+d:c+":"+d;case"minct":return 60*c+d;default:alert("Invalid getTime() argument!")}}function passWord(a){passWordCheck(document.getElementById(a).value)?(document.getElementById("l").innerHTML='<p>\t\t\t\t<button type="button" onclick="exportXLSX(true)">Export Data</button>\t\t\t</p>\t\t\t<p>\t\t\t\t<object id="file-object"></object>\t\t\t\t<button type="button" onclick="addToXLSX()">Add Data to Selected File</button>\t\t\t\t<a href="https://chrome.google.com/webstore/detail/downloads-overwrite-exist/fkomnceojfhfkgjgcijfahmgeljomcfk">This Chrome extension is required to update an existing spreadsheet.</a>\t\t\t</p>\t\t\t<p>\t\t\t\tSchedule for Day:\t\t\t\t<select id="sselector" onchange="schedule = document.getElementById("sselector").value;">\t\t\t\t\t<option value="normal">Standard day</option>\t\t\t\t\t<option value="earlyReleaseOrClubDay">Early Release/Club Day</option>\t\t\t\t\t<option value="oneHourDelay">1 Hour Delay</option>\t\t\t\t\t<option value="twoHourDelay">2 Hour Delay</option>\t\t\t\t</select>\t\t\t</p>\t\t\t<button type="button" onclick="endVisitors(); endCVisits()">Sign Out All Visitors</button>\t\t\t<button type="button" onclick="closeMenu()">Lock Librarian Menu</button>',document.getElementById("sselector").value=schedule,epx.openLocal({labelButton:"Select Excel File"},function(){}),constructDisplay(hallPass.slice(0),"hdisplay"),constructDisplay(visitors.slice(0),"vdisplay"),constructDisplay(cVisits.slice(0),"cdisplay")):alert("Incorrect password!")}function closeMenu(){document.getElementById("l").innerHTML='<span><input type="password" id="pwbox" placeholder="Password"></span>\t\t<span><button onclick="passWord(\'pwbox\')">Submit</button></span>',constructDisplay(hallPass.slice(0),"hdisplay"),constructDisplay(visitors.slice(0),"vdisplay"),constructDisplay(cVisits.slice(0),"cdisplay")}function hallPassTeachers(){var a=document.getElementById("hdestination").value,b=document.getElementById("moreinputs");switch(a){case"Teacher":b.innerHTML='<input type="text" id="hteacher" placeholder="Teacher">';break;case"Guidance":b.innerHTML='<input type="text" id="hcounselor" placeholder="Guidance Counselor">';break;default:b.innerHTML=""}}function passWordCheck(a){var b=[66,72,83,76,105,98,114,97,114,121];if(b.length!=a.length)return!1;for(i=a.length-1;i>=0;i--)if(b[i]!=a.charCodeAt(i))return!1;return!0}function whichClass(){for(var a=beginTimes(),b=0,c=getTime("minct");c>=a[b];)b++;return b}function beginTimes(){switch(schedule){case"earlyReleaseOrClubDay":return[486,540,546,595,601,685,691,740];case"oneHourDelay":return[546,620,626,700,706,810,816,890];case"twoHourDelay":return[606,665,671,730,736,825,831,890];default:return[486,575,581,670,676,795,801,890]}}var hallPass=[["Name","Time Out","Time In","Destination"]],visitors=[["Name","Time In","Time Out","Reason","Teacher"]],cVisits=[["Name","Time In","Time Out","Reason","Student Count"]],firstClass=[["Name","Time","Tardy?"]],secondClass=[["Name","Time","Tardy?"]],thirdClass=[["Name","Time","Tardy?"]],fourthClass=[["Name","Time","Tardy?"]],sheetNames=["Hall Pass","Visitors","Class Visitors","Class 1","Class 2","Class 3","Class 4"],schedule="normal",epx=new ExcelPlus,lIOV=!1,lIOC=!1,lIOH=!1;setInterval(function(){exportXLSX(!1)},36e5);function addToXLSX(){if(7!=epx.getSheetNames().length)return void alert("Invalid file uploaded!");endAll();for(var a=[hallPass.slice(0),visitors.slice(0),cVisits.slice(0),firstClass.slice(0),secondClass.slice(0),thirdClass.slice(0),fourthClass.slice(0)],b=0;b<7;b++)a[b].shift(),a[b]=addDate(a[b]),epx.selectSheet(sheetNames[b]),writeData(epx,a[b]);epx.saveAs("data.xlsx")}function writeData(a,b){for(i=0;i<b.length;i++)a.writeNextRow(b[i])}function monthWord(){return["January","February","March","April","May","June","July","August","September","October","November","December"][(new Date).getMonth()]}function loggedInOnly(a){switch(a){case"v":constructDisplay(visitors.slice(0),"vdisplay"),document.getElementById("liov").innerHTML=lIOV?"View Logged In Only":"View All",lIOV=!lIOV;break;case"h":constructDisplay(hallPass.slice(0),"hdisplay"),document.getElementById("lioh").innerHTML=lIOH?"View Logged In Only":"View All",lIOH=!lIOH;break;case"c":constructDisplay(cVisits.slice(0),"cdisplay"),document.getElementById("lioc").innerHTML=lIOC?"View Logged In Only":"View All",lIOC=!lIOC;break;default:alert("Error in loggedInOnly()!")}}function lIODisplay(a){for(i=0;i<a.length;i++)a[i][2].length<=5&&(a.splice(i,1),i--);return a}function addDate(a){var b=new Date;for(i=a.length-1;i>=0;i--)a[i].push(b.toLocaleDateString());return a}function exportXLSX(a){var b=new ExcelPlus,c=[hallPass,visitors,cVisits,firstClass,secondClass,thirdClass,fourthClass];a&&endAll(),b.createFile(sheetNames);for(var d=0;d<7;d++)b.write({sheet:sheetNames[d],content:c[d]});var e=new Date;b.saveAs(e.toLocaleString().replace("/","-")+".xlsx")}function tabSelect(a,b){var d,c=document.getElementsByClassName("tabcontent"),e=document.getElementsByClassName("tablinks");for(d=0;d<c.length;d++)c[d].style.display="none";for(d=0;d<e.length;d++)e[d].className=e[d].className.replace(" active","");document.getElementById(b).style.display="block",a.currentTarget.className+=" active"}function endEntry(a,b,c){b[a][2]=getTime("string12"),constructDisplay(b.slice(0),c)}function removeEntry(a,b){switch(b){case"vdisplay":visitors.splice(a,1),constructDisplay(visitors.slice(0),b);break;case"cdisplay":cVisits.splice(a,1),constructDisplay(cVisits.slice(0),b);break;case"hdisplay":tgtArray=hallPass,hallPass.splice(a,1),constructDisplay(hallPass.slice(0),b)}}function endAll(){endVisitors(),endCVisits(),endHallPass()}function endVisitors(){for(var a=visitors.length-1;a>0;a--)visitors[a][2].length>10&&endEntry(a,visitors,"vdisplay")}function endCVisits(){for(var a=cVisits.length-1;a>0;a--)cVisits[a][2].length>10&&endEntry(a,cVisits,"cdisplay")}function endHallPass(){for(var a=hallPass.length-1;a>0;a--)hallPass[a][2].length>10&&endEntry(a,hallPass,"hdisplay")}function constructDisplay(a,b){var f,g,c=a,d=document.getElementById(b),e="";switch(b){case"vdisplay":lIOV&&(c=lIODisplay(c));break;case"cdisplay":lIOC&&(c=lIODisplay(c));break;case"hdisplay":lIOH&&(c=lIODisplay(c));break;default:alert("Error in constructDisplay!")}for(c.reverse(),c.unshift(c.pop()),f=0;f<c.length;f++){for(e+="<tr>",g=0;g<c[0].length;g++)e+=0==f?"<th>":"<td>",e+=c[f][g],e+=0==f?"</th>":"</td>",g++;null!=document.getElementById("sselector")&&f>0&&(e+='<td><button type="button" onclick="removeEntry('+(c.length-f)+", '"+b+"')\">X</button></td>"),e+="</tr>"}d.innerHTML=e}function submitData(a){var c,b=getTime("string12");switch(a){case"a":if(0==document.getElementById("afname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("alname").value.length)return void alert("You need to input a last name!");switch(c=document.getElementById("afname").value+" "+document.getElementById("alname").value,document.getElementById("afname").value="",document.getElementById("alname").value="",whichClass()){case 0:firstClass[firstClass.length]=new Array(c,b,!1);break;case 1:firstClass[firstClass.length]=new Array(c,b,!0);break;case 2:secondClass[secondClass.length]=new Array(c,b,!1);break;case 3:secondClass[secondClass.length]=new Array(c,b,!0);break;case 4:thirdClass[thirdClass.length]=new Array(c,b,!1);break;case 5:thirdClass[thirdClass.length]=new Array(c,b,!0);break;case 6:fourthClass[fourthClass.length]=new Array(c,b,!1);break;case 7:fourthClass[fourthClass.length]=new Array(c,b,!0);break;case 8:return void alert("The school day has ended!");default:return void alert("Error in submitData()!")}alert(c+" is now signed in!");break;case"h":var d=document.getElementById("hdestination"),e=d.value;if(0==document.getElementById("hfname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("hlname").value.length)return void alert("You need to input a last name!");if(null!=document.getElementById("hteacher")){var f=document.getElementById("hteacher").value;if(0==f.length)return void alert("You need to input the teacher you're going to!");e=d.value+": "+f}if(null!=document.getElementById("hcounselor")){var g=document.getElementById("hcounselor").value;if(0==g.length)return void alert("You need to input the counselor you're going to!");e=d.value+": "+g}c=document.getElementById("hfname").value+" "+document.getElementById("hlname").value,document.getElementById("hfname").value="",document.getElementById("hlname").value="",hallPass[hallPass.length]=new Array(c,b,'<button type="button" onclick="endEntry('+hallPass.length+", hallPass, 'hdisplay')\">In</button>",e),d.value="Bathroom",hallPassTeachers(),constructDisplay(hallPass.slice(0),"hdisplay");break;case"v":if(0==document.getElementById("vfname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("vlname").value.length)return void alert("You need to input a last name!");c=document.getElementById("vfname").value+" "+document.getElementById("vlname").value,document.getElementById("vfname").value="",document.getElementById("vlname").value="",visitors[visitors.length]=new Array(c,b,'<button type="button" onclick="endEntry('+visitors.length+", visitors, 'vdisplay')\">Out</button>",document.getElementById("vreason").value,document.getElementById("vteacher").value),document.getElementById("vreason").value="Work independently on a class assignment",document.getElementById("vteacher").value="C. Baker",constructDisplay(visitors.slice(0),"vdisplay");break;case"c":if(0==document.getElementById("cfname").value.length)return void alert("You need to input a first name!");if(0==document.getElementById("clname").value.length)return void alert("You need to input a last name!");if(0==document.getElementById("creason").value.length)return void alert("You need to input a reason!");if(0==document.getElementById("classsize").value.length)return void alert("You need to input the number of students!");c=document.getElementById("cfname").value+" "+document.getElementById("clname").value,document.getElementById("cfname").value="",document.getElementById("clname").value="",cVisits[cVisits.length]=new Array(c,b,'<button type="button" onclick="endEntry('+cVisits.length+", cVisits, 'cdisplay')\">Out</button>",document.getElementById("creason").value,document.getElementById("classsize").value),constructDisplay(cVisits.slice(0),"cdisplay"),document.getElementById("creason").value="",document.getElementById("classsize").value="";break;default:alert("Error in submitData()!")}}function getTime(a){var b=new Date,c=b.getHours(),d=b.getMinutes();switch(a){case"array":return[c,d];case"string12":return c>12&&(c-=12),d<10?c+":0"+d:c+":"+d;case"string24":return d<10?c+":0"+d:c+":"+d;case"minct":return 60*c+d;default:alert("Invalid getTime() argument!")}}function passWord(a){passWordCheck(document.getElementById(a).value)?(document.getElementById("l").innerHTML='<p>\t\t\t\t<button type="button" onclick="exportXLSX(true)">Export Data</button>\t\t\t</p>\t\t\t<p>\t\t\t\t<object id="file-object"></object>\t\t\t\t<button type="button" onclick="addToXLSX()">Add Data to Selected File</button>\t\t\t\t<a href="https://chrome.google.com/webstore/detail/downloads-overwrite-exist/fkomnceojfhfkgjgcijfahmgeljomcfk">This Chrome extension is required to update an existing spreadsheet.</a>\t\t\t</p>\t\t\t<p>\t\t\t\tSchedule for Day:\t\t\t\t<select id="sselector" onchange="schedule = document.getElementById("sselector").value;">\t\t\t\t\t<option value="normal">Standard day</option>\t\t\t\t\t<option value="earlyReleaseOrClubDay">Early Release/Club Day</option>\t\t\t\t\t<option value="oneHourDelay">1 Hour Delay</option>\t\t\t\t\t<option value="twoHourDelay">2 Hour Delay</option>\t\t\t\t</select>\t\t\t</p>\t\t\t<button type="button" onclick="endVisitors(); endCVisits()">Sign Out All Visitors</button>\t\t\t<button type="button" onclick="closeMenu()">Lock Librarian Menu</button>',document.getElementById("sselector").value=schedule,epx.openLocal({labelButton:"Select Excel File"},function(){}),constructDisplay(hallPass.slice(0),"hdisplay"),constructDisplay(visitors.slice(0),"vdisplay"),constructDisplay(cVisits.slice(0),"cdisplay")):alert("Incorrect password!")}function closeMenu(){document.getElementById("l").innerHTML='<span><input type="password" id="pwbox" placeholder="Password"></span>\t\t<span><button onclick="passWord(\'pwbox\')">Submit</button></span>',constructDisplay(hallPass.slice(0),"hdisplay"),constructDisplay(visitors.slice(0),"vdisplay"),constructDisplay(cVisits.slice(0),"cdisplay")}function hallPassTeachers(){var a=document.getElementById("hdestination").value,b=document.getElementById("moreinputs");switch(a){case"Teacher":b.innerHTML='<input type="text" id="hteacher" placeholder="Teacher">';break;case"Guidance":b.innerHTML='<input type="text" id="hcounselor" placeholder="Guidance Counselor">';break;default:b.innerHTML=""}}function passWordCheck(a){var b=[66,72,83,76,105,98,114,97,114,121];if(b.length!=a.length)return!1;for(i=a.length-1;i>=0;i--)if(b[i]!=a.charCodeAt(i))return!1;return!0}function whichClass(){for(var a=beginTimes(),b=0,c=getTime("minct");c>=a[b];)b++;return b}function beginTimes(){switch(schedule){case"earlyReleaseOrClubDay":return[486,540,546,595,601,685,691,740];case"oneHourDelay":return[546,620,626,700,706,810,816,890];case"twoHourDelay":return[606,665,671,730,736,825,831,890];default:return[486,575,581,670,676,795,801,890]}}var hallPass=[["Name","Time Out","Time In","Destination"]],visitors=[["Name","Time In","Time Out","Reason","Teacher"]],cVisits=[["Name","Time In","Time Out","Reason","Student Count"]],firstClass=[["Name","Time","Tardy?"]],secondClass=[["Name","Time","Tardy?"]],thirdClass=[["Name","Time","Tardy?"]],fourthClass=[["Name","Time","Tardy?"]],sheetNames=["Hall Pass","Visitors","Class Visitors","Class 1","Class 2","Class 3","Class 4"],schedule="normal",epx=new ExcelPlus,lIOV=!1,lIOC=!1,lIOH=!1;setInterval(function(){exportXLSX(!1)},36e5);